<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Run a Node - Guide to Nearcore Development</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Architecture</li><li class="chapter-item expanded "><a href="../../architecture/index.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../../architecture/how/index.html"><strong aria-hidden="true">2.</strong> How neard works</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../architecture/how/sync.html"><strong aria-hidden="true">2.1.</strong> How Sync Works</a></li><li class="chapter-item expanded "><a href="../../architecture/how/gc.html"><strong aria-hidden="true">2.2.</strong> Garbage Collection</a></li><li class="chapter-item expanded "><a href="../../architecture/how/epoch.html"><strong aria-hidden="true">2.3.</strong> How Epoch Works</a></li><li class="chapter-item expanded "><a href="../../architecture/how/tx_routing.html"><strong aria-hidden="true">2.4.</strong> Transaction Routing</a></li><li class="chapter-item expanded "><a href="../../architecture/how/tx_receipts.html"><strong aria-hidden="true">2.5.</strong> Transactions And Receipts</a></li><li class="chapter-item expanded "><a href="../../architecture/how/cross-shard.html"><strong aria-hidden="true">2.6.</strong> Cross shard transactions - deep dive</a></li><li class="chapter-item expanded "><a href="../../architecture/how/gas.html"><strong aria-hidden="true">2.7.</strong> Gas</a></li><li class="chapter-item expanded "><a href="../../architecture/how/receipt-congestion.html"><strong aria-hidden="true">2.8.</strong> Receipt Congestion</a></li><li class="chapter-item expanded "><a href="../../architecture/how/meta-tx.html"><strong aria-hidden="true">2.9.</strong> Meta transactions</a></li><li class="chapter-item expanded "><a href="../../architecture/how/serialization.html"><strong aria-hidden="true">2.10.</strong> Serialization: Borsh, Json, ProtoBuf</a></li><li class="chapter-item expanded "><a href="../../architecture/how/proofs.html"><strong aria-hidden="true">2.11.</strong> Proofs</a></li><li class="chapter-item expanded "><a href="../../architecture/how/resharding_v2.html"><strong aria-hidden="true">2.12.</strong> Resharding V2</a></li></ol></li><li class="chapter-item expanded "><a href="../../architecture/next/index.html"><strong aria-hidden="true">3.</strong> How neard will work</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../architecture/next/catchup_and_state_sync.html"><strong aria-hidden="true">3.1.</strong> Catchup and state sync improvements</a></li><li class="chapter-item expanded "><a href="../../architecture/next/malicious_chunk_producer_and_phase2.html"><strong aria-hidden="true">3.2.</strong> Malicious producers and phase 2</a></li></ol></li><li class="chapter-item expanded "><a href="../../architecture/storage.html"><strong aria-hidden="true">4.</strong> Storage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../architecture/storage/flow.html"><strong aria-hidden="true">4.1.</strong> Storage Request Flow</a></li><li class="chapter-item expanded "><a href="../../architecture/storage/trie_storage.html"><strong aria-hidden="true">4.2.</strong> Trie Storage</a></li><li class="chapter-item expanded "><a href="../../architecture/storage/database.html"><strong aria-hidden="true">4.3.</strong> Database Format</a></li><li class="chapter-item expanded "><a href="../../architecture/storage/flat_storage.html"><strong aria-hidden="true">4.4.</strong> Flat Storage</a></li></ol></li><li class="chapter-item expanded "><a href="../../architecture/network.html"><strong aria-hidden="true">5.</strong> Network</a></li><li class="chapter-item expanded "><a href="../../architecture/gas/index.html"><strong aria-hidden="true">6.</strong> Gas Cost Parameters</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../architecture/gas/parameter_definition.html"><strong aria-hidden="true">6.1.</strong> Parameter Definitions</a></li><li class="chapter-item expanded "><a href="../../architecture/gas/gas_profile.html"><strong aria-hidden="true">6.2.</strong> Gas Profile</a></li><li class="chapter-item expanded "><a href="../../architecture/gas/estimator.html"><strong aria-hidden="true">6.3.</strong> Runtime Parameter Estimator</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Practices</li><li class="chapter-item expanded "><a href="../../practices/index.html"><strong aria-hidden="true">7.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../../practices/rust.html"><strong aria-hidden="true">8.</strong> Rust ðŸ¦€</a></li><li class="chapter-item expanded "><a href="../../practices/workflows/index.html"><strong aria-hidden="true">9.</strong> Workflows</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../practices/workflows/run_a_node.html" class="active"><strong aria-hidden="true">9.1.</strong> Run a Node</a></li><li class="chapter-item expanded "><a href="../../practices/workflows/deploy_a_contract.html"><strong aria-hidden="true">9.2.</strong> Deploy a Contract</a></li><li class="chapter-item expanded "><a href="../../practices/workflows/gas_estimations.html"><strong aria-hidden="true">9.3.</strong> Run Gas Estimations</a></li><li class="chapter-item expanded "><a href="../../practices/workflows/localnet_on_many_machines.html"><strong aria-hidden="true">9.4.</strong> Localnet on many machines</a></li><li class="chapter-item expanded "><a href="../../practices/workflows/io_trace.html"><strong aria-hidden="true">9.5.</strong> IO tracing</a></li><li class="chapter-item expanded "><a href="../../practices/workflows/profiling.html"><strong aria-hidden="true">9.6.</strong> Profiling</a></li><li class="chapter-item expanded "><a href="../../practices/workflows/otel_traces.html"><strong aria-hidden="true">9.7.</strong> Working with OpenTelemetry Traces</a></li></ol></li><li class="chapter-item expanded "><a href="../../practices/style.html"><strong aria-hidden="true">10.</strong> Code Style</a></li><li class="chapter-item expanded "><a href="../../practices/docs.html"><strong aria-hidden="true">11.</strong> Documentation</a></li><li class="chapter-item expanded "><a href="../../practices/tracking_issues.html"><strong aria-hidden="true">12.</strong> Tracking Issues</a></li><li class="chapter-item expanded "><a href="../../practices/security_vulnerabilities.html"><strong aria-hidden="true">13.</strong> Security Vulnerabilities</a></li><li class="chapter-item expanded "><a href="../../practices/fast_builds.html"><strong aria-hidden="true">14.</strong> Fast Builds</a></li><li class="chapter-item expanded "><a href="../../practices/testing/index.html"><strong aria-hidden="true">15.</strong> Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../practices/testing/python_tests.html"><strong aria-hidden="true">15.1.</strong> Python Tests</a></li><li class="chapter-item expanded "><a href="../../practices/testing/test_utils.html"><strong aria-hidden="true">15.2.</strong> Testing Utils</a></li><li class="chapter-item expanded "><a href="../../practices/testing/coverage.html"><strong aria-hidden="true">15.3.</strong> Test Coverage</a></li></ol></li><li class="chapter-item expanded "><a href="../../practices/protocol_upgrade.html"><strong aria-hidden="true">16.</strong> Protocol Upgrade</a></li><li class="chapter-item expanded affix "><li class="part-title">Advanced configuration</li><li class="chapter-item expanded "><a href="../../advanced_configuration/networking.html"><strong aria-hidden="true">17.</strong> Networking</a></li><li class="chapter-item expanded affix "><li class="part-title">Custom test networks</li><li class="chapter-item expanded "><a href="../../test_networks/mainnet_spoon.html"><strong aria-hidden="true">18.</strong> Starting a network from mainnet state</a></li><li class="chapter-item expanded affix "><li class="part-title">Misc</li><li class="chapter-item expanded "><a href="../../misc/index.html"><strong aria-hidden="true">19.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../../misc/state_sync_dump.html"><strong aria-hidden="true">20.</strong> State Sync Dump</a></li><li class="chapter-item expanded "><a href="../../misc/archival_data_recovery.html"><strong aria-hidden="true">21.</strong> Archival node - recovery of missing data</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Guide to Nearcore Development</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/near/nearcore/tree/master/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/near/nearcore/edit/master/docs/./practices/workflows/run_a_node.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="run-a-node"><a class="header" href="#run-a-node">Run a Node</a></h1>
<p>This chapter focuses on the basics of running a node you've just built from
source. It tries to explain how the thing works under the hood and pays
relatively little attention to the various shortcuts we have.</p>
<h2 id="building-the-node"><a class="header" href="#building-the-node">Building the Node</a></h2>
<p>Start with the following command:</p>
<pre><code class="language-console">cargo run --profile dev-release -p neard -- --help
</code></pre>
<p>This command builds <code>neard</code> and asks it to show <code>--help</code>. Building <code>neard</code> takes
a while, take a look at <a href="../fast_builds.html">Fast Builds</a> chapter to learn how to
speed it up.</p>
<p>Let's dissect the command:</p>
<ul>
<li><code>cargo run</code> asks <code>Cargo</code>, the package manager/build tool, to run our
application. If you don't have <code>cargo</code>, install it via <a href="https://rustup.rs">https://rustup.rs</a></li>
<li><code>--profile dev-release</code> is our
<a href="https://doc.rust-lang.org/cargo/reference/profiles.html#custom-profiles">custom profile</a>
to build a somewhat optimized version of the code. The default debug
profile is faster to compile, but produces a node that is too slow to
participate in a real network. The <code>--release</code> profile produces a fully
optimized node, but that's very slow to compile. So <code>--dev-release</code>
is a sweet spot for us! However, never use it for actual production nodes.</li>
<li><code>-p neard</code> asks to build the <code>neard</code> package. We use
<a href="https://doc.rust-lang.org/cargo/reference/workspaces.html">cargo workspaces</a>
to organize our code. The <code>neard</code> package in the top-level <code>/neard</code> directory
is the final binary that ties everything together.</li>
<li><code>--</code> tells cargo to pass the rest of the arguments through to <code>neard</code>.</li>
<li><code>--help</code> instructs <code>neard</code> to list available CLI arguments and subcommands.</li>
</ul>
<p><strong>Note:</strong> Building <code>neard</code> might fail with an openssl or CC error. This means
that you lack some non-rust dependencies we use (openssl and rocksdb mainly). We
currently don't have docs on how to install those, but (basically) you want to
<code>sudo apt install</code> (or whichever distro/package manager you use) missing bits.</p>
<h2 id="preparing-tiny-network"><a class="header" href="#preparing-tiny-network">Preparing Tiny Network</a></h2>
<p>Typically, you want <code>neard</code> to connect to some network, like <code>mainnet</code> or
<code>testnet</code>. We'll get there in time, but we'll start small. For the current
chapter, we will run a network consisting of just a single node -- our own.</p>
<p>The first step there is creating the required configuration. Run the <code>init</code>
command to create config files:</p>
<pre><code class="language-console">$ cargo run --profile dev-release -p neard -- init
INFO neard: version=&quot;trunk&quot; build=&quot;1.1.0-3091-ga8964d200-modified&quot; latest_protocol=57
INFO near: Using key ed25519:B41GMfqE2jWHVwrPLbD7YmjZxxeQE9WA9Ua2jffP5dVQ for test.near
INFO near: Using key ed25519:34d4aFJEmc2A96UXMa9kQCF8g2EfzZG9gCkBAPcsVZaz for node
INFO near: Generated node key, validator key, genesis file in ~/.near
</code></pre>
<p>As the log output says, we are just generating <em>some things</em> in <code>~/.near</code>.
Let's take a look:</p>
<pre><code class="language-console">$ ls ~/.near
config.json
genesis.json
node_key.json
validator_key.json
</code></pre>
<p>The most interesting file here is perhaps <code>genesis.json</code> -- it specifies the
initial state of our blockchain. There are a bunch of hugely important fields
there, which we'll ignore here. The part we'll look at is the <code>.records</code>, which
contains the actual initial data:</p>
<pre><code class="language-console">$ cat ~/.near/genesis.json | jq '.records'
[
  {
    &quot;Account&quot;: {
      &quot;account_id&quot;: &quot;test.near&quot;,
      &quot;account&quot;: {
        &quot;amount&quot;: &quot;1000000000000000000000000000000000&quot;,
        &quot;locked&quot;: &quot;50000000000000000000000000000000&quot;,
        &quot;code_hash&quot;: &quot;11111111111111111111111111111111&quot;,
        &quot;storage_usage&quot;: 0,
        &quot;version&quot;: &quot;V1&quot;
      }
    }
  },
  {
    &quot;AccessKey&quot;: {
      &quot;account_id&quot;: &quot;test.near&quot;,
      &quot;public_key&quot;: &quot;ed25519:B41GMfqE2jWHVwrPLbD7YmjZxxeQE9WA9Ua2jffP5dVQ&quot;,
      &quot;access_key&quot;: {
        &quot;nonce&quot;: 0,
        &quot;permission&quot;: &quot;FullAccess&quot;
      }
    }
  },
  {
    &quot;Account&quot;: {
      &quot;account_id&quot;: &quot;near&quot;,
      &quot;account&quot;: {
        &quot;amount&quot;: &quot;1000000000000000000000000000000000&quot;,
        &quot;locked&quot;: &quot;0&quot;,
        &quot;code_hash&quot;: &quot;11111111111111111111111111111111&quot;,
        &quot;storage_usage&quot;: 0,
        &quot;version&quot;: &quot;V1&quot;
      }
    }
  },
  {
    &quot;AccessKey&quot;: {
      &quot;account_id&quot;: &quot;near&quot;,
      &quot;public_key&quot;: &quot;ed25519:546XB2oHhj7PzUKHiH9Xve3Ze5q1JiW2WTh6abXFED3c&quot;,
      &quot;access_key&quot;: {
        &quot;nonce&quot;: 0,
        &quot;permission&quot;: &quot;FullAccess&quot;
      }
    }
  }
</code></pre>
<p>(I am using the <a href="https://stedolan.github.io/jq/">jq</a> utility here)</p>
<p>We see that we have two accounts here, and we also see their public keys (but
not the private ones).</p>
<p>One of these accounts is a validator:</p>
<pre><code>$ cat ~/.near/genesis.json | jq '.validators'
[
  {
    &quot;account_id&quot;: &quot;test.near&quot;,
    &quot;public_key&quot;: &quot;ed25519:B41GMfqE2jWHVwrPLbD7YmjZxxeQE9WA9Ua2jffP5dVQ&quot;,
    &quot;amount&quot;: &quot;50000000000000000000000000000000&quot;
  }
]
</code></pre>
<p>Now, if we</p>
<pre><code class="language-console">cat ~/.near/validator_key.json
</code></pre>
<p>we'll see</p>
<pre><code class="language-json">{
  &quot;account_id&quot;: &quot;test.near&quot;,
  &quot;public_key&quot;: &quot;ed25519:B41GMfqE2jWHVwrPLbD7YmjZxxeQE9WA9Ua2jffP5dVQ&quot;,
  &quot;secret_key&quot;: &quot;ed25519:3x2dUQgBoEqNvKwPjfDE8zDVJgM8ysqb641PYHV28mGPu61WWv332p8keMDKHUEdf7GVBm4f6z4D1XRgBxnGPd7L&quot;
}
</code></pre>
<p>That is, we have a secret key for the sole validator in our network, how
convenient.</p>
<p>To recap, <code>neard init</code> without arguments creates a config for a new network
that starts with a single validator, for which we have the keys.</p>
<p>You might be wondering what <code>~/.near/node_key.json</code> is. That's not too
important, but, in our network, there's no 1-1 correspondence between machines
participating in the peer-to-peer network and accounts on the blockchain. So the
<code>node_key</code> specifies the keypair we'll use when signing network packets. These
packets internally will contain messages signed with the validator's key, and
these internal messages will drive the evolution of the blockchain state.</p>
<p>Finally, <code>~/.near/config.json</code> contains various configs for the node itself.
These are configs that don't affect the rules guiding the evolution of the
blockchain state, but rather things like timeouts, database settings and
such.</p>
<p>The only field we'll look at is <code>boot_nodes</code>:</p>
<pre><code class="language-console">$ cat ~/.near/config.json | jq '.network.boot_nodes'
&quot;&quot;
</code></pre>
<p>It's empty! The <code>boot_nodes</code> specify IPs of the initial nodes our node will
try to connect to on startup. As we are looking into running a single-node
network, we want to leave it empty. But, if you would like to connect to
mainnet, you'd have to set this to some nodes from the mainnet you already know.
You'd also have to ensure that you use the same genesis as the mainnet though
-- if the node tries to connect to a network with a different genesis, it
is rejected.</p>
<h2 id="running-the-network"><a class="header" href="#running-the-network">Running the Network</a></h2>
<p>Finally,</p>
<!-- cspell:ignore matklad -->
<pre><code class="language-console">$ cargo run --profile dev-release -p neard -- run
INFO neard: version=&quot;trunk&quot; build=&quot;1.1.0-3091-ga8964d200-modified&quot; latest_protocol=57
INFO near: Creating a new RocksDB database path=/home/matklad/.near/data
INFO db: Created a new RocksDB instance. num_instances=1
INFO stats: #       0 4xecSHqTKx2q8JNQNapVEi5jxzewjxAnVFhMd4v5LqNh Validator | 1 validator 0 peers â¬‡ 0 B/s â¬† 0 B/s NaN bps 0 gas/s CPU: 0%, Mem: 50.8 MB
INFO near_chain::doomslug: ready to produce block @ 1, has enough approvals for 59.907Âµs, has enough chunks
INFO near_chain::doomslug: ready to produce block @ 2, has enough approvals for 40.732Âµs, has enough chunks
INFO near_chain::doomslug: ready to produce block @ 3, has enough approvals for 65.341Âµs, has enough chunks
INFO near_chain::doomslug: ready to produce block @ 4, has enough approvals for 51.916Âµs, has enough chunks
INFO near_chain::doomslug: ready to produce block @ 5, has enough approvals for 37.155Âµs, has enough chunks
...
</code></pre>
<p>ðŸŽ‰ it's alive!</p>
<p>So, what's going on here?</p>
<p>Our node is running a single-node network. As the network only has a single
validator, and the node has the keys for the validator, the node can produce
blocks by itself. Note the increasing <code>@ 1</code>, <code>@ 2</code>, ... numbers. That
means that our network grows.</p>
<p>Let's stop the node with <code>^C</code> and look around</p>
<pre><code class="language-console">INFO near_chain::doomslug: ready to produce block @ 42, has enough approvals for 56.759Âµs, has enough chunks
^C WARN neard: SIGINT, stopping... this may take a few minutes.
INFO neard: Waiting for RocksDB to gracefully shutdown
INFO db: Waiting for remaining RocksDB instances to shut down num_instances=1
INFO db: All RocksDB instances shut down
$
</code></pre>
<p>The main change now is that we have a <code>~/.near/data</code> directory which holds the
state of the network in various rocksdb tables:</p>
<pre><code class="language-console">$ ls ~/.near/data
 000004.log
 CURRENT
 IDENTITY
 LOCK
 LOG
 MANIFEST-000005
 OPTIONS-000107
 OPTIONS-000109
</code></pre>
<p>It doesn't matter what those are, &quot;rocksdb stuff&quot; is a fine level of understanding
here. The important bit here is that the node remembers the state of the network,
so, when we restart it, it continues from around the last block:</p>
<pre><code class="language-console">$ cargo run --profile dev-release -p neard -- run
INFO neard: version=&quot;trunk&quot; build=&quot;1.1.0-3091-ga8964d200-modified&quot; latest_protocol=57
INFO db: Created a new RocksDB instance. num_instances=1
INFO db: Dropped a RocksDB instance. num_instances=0
INFO near: Opening an existing RocksDB database path=/home/matklad/.near/data
INFO db: Created a new RocksDB instance. num_instances=1
INFO stats: #       5 Cfba39eH7cyNfKn9GoKTyRg8YrhoY1nQxQs66tLBYwRH Validator | 1 validator 0 peers â¬‡ 0 B/s â¬† 0 B/s NaN bps 0 gas/s CPU: 0%, Mem: 49.4 MB
INFO near_chain::doomslug: not ready to produce block @ 43, need to wait 366.58789ms, has enough approvals for 78.776Âµs
INFO near_chain::doomslug: not ready to produce block @ 43, need to wait 265.547148ms, has enough approvals for 101.119518ms
INFO near_chain::doomslug: not ready to produce block @ 43, need to wait 164.509153ms, has enough approvals for 202.157513ms
INFO near_chain::doomslug: not ready to produce block @ 43, need to wait 63.176926ms, has enough approvals for 303.48974ms
INFO near_chain::doomslug: ready to produce block @ 43, has enough approvals for 404.41498ms, does not have enough chunks
INFO near_chain::doomslug: ready to produce block @ 44, has enough approvals for 50.07Âµs, has enough chunks
INFO near_chain::doomslug: ready to produce block @ 45, has enough approvals for 45.093Âµs, has enough chunks
</code></pre>
<h2 id="interacting-with-the-node"><a class="header" href="#interacting-with-the-node">Interacting With the Node</a></h2>
<p>Ok, now our node is running, let's poke it! The node exposes a JSON RPC interface
which can be used to interact with the node itself (to, e.g., do a health check)
or with the blockchain (to query information about the blockchain state or to
submit a transaction).</p>
<pre><code class="language-console">$ http get http://localhost:3030/status
HTTP/1.1 200 OK
access-control-allow-credentials: true
access-control-expose-headers: accept-encoding, accept, connection, host, user-agent
content-length: 1010
content-type: application/json
date: Tue, 15 Nov 2022 13:58:13 GMT
vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers

{
    &quot;chain_id&quot;: &quot;test-chain-rR8Ct&quot;,
    &quot;latest_protocol_version&quot;: 57,
    &quot;node_key&quot;: &quot;ed25519:71QRP9qKcYRUYXTLNnrmRc1NZSdBaBo9nKZ88DK5USNf&quot;,
    &quot;node_public_key&quot;: &quot;ed25519:5A5QHyLayA9zksJZGBzveTgBRecpsVS4ohuxujMAFLLa&quot;,
    &quot;protocol_version&quot;: 57,
    &quot;rpc_addr&quot;: &quot;0.0.0.0:3030&quot;,
    &quot;sync_info&quot;: {
        &quot;earliest_block_hash&quot;: &quot;6gJLCnThQENYFbnFQeqQvFvRsTS5w87bf3xf8WN1CMUX&quot;,
        &quot;earliest_block_height&quot;: 0,
        &quot;earliest_block_time&quot;: &quot;2022-11-15T13:45:53.062613669Z&quot;,
        &quot;epoch_id&quot;: &quot;6gJLCnThQENYFbnFQeqQvFvRsTS5w87bf3xf8WN1CMUX&quot;,
        &quot;epoch_start_height&quot;: 501,
        &quot;latest_block_hash&quot;: &quot;9JC9o3rZrDLubNxVr91qMYvaDiumzwtQybj1ZZR9dhbK&quot;,
        &quot;latest_block_height&quot;: 952,
        &quot;latest_block_time&quot;: &quot;2022-11-15T13:58:13.185721125Z&quot;,
        &quot;latest_state_root&quot;: &quot;9kEYQtWczrdzKCCuFzPDX3Vtar1pFPXMdLU5HJyF8Ght&quot;,
        &quot;syncing&quot;: false
    },
    &quot;uptime_sec&quot;: 570,
    &quot;validator_account_id&quot;: &quot;test.near&quot;,
    &quot;validator_public_key&quot;: &quot;ed25519:71QRP9qKcYRUYXTLNnrmRc1NZSdBaBo9nKZ88DK5USNf&quot;,
    &quot;validators&quot;: [
        {
            &quot;account_id&quot;: &quot;test.near&quot;,
            &quot;is_slashed&quot;: false
        }
    ],
    &quot;version&quot;: {
        &quot;build&quot;: &quot;1.1.0-3091-ga8964d200-modified&quot;,
        &quot;rustc_version&quot;: &quot;1.65.0&quot;,
        &quot;version&quot;: &quot;trunk&quot;
    }
}
</code></pre>
<p>(I am using <a href="https://httpie.io/cli">HTTPie here</a>)</p>
<p>Note how <code>&quot;latest_block_height&quot;: 952</code> corresponds to <code>@ 952</code> we see in the logs.</p>
<p>Let's query the blockchain state:</p>
<pre><code>$ http post http://localhost:3030/ method=query jsonrpc=2.0 id=1 \
     params:='{&quot;request_type&quot;: &quot;view_account&quot;, &quot;finality&quot;: &quot;final&quot;, &quot;account_id&quot;: &quot;test.near&quot;}'
Î» http post http://localhost:3030/ method=query jsonrpc=2.0 id=1 \
           params:='{&quot;request_type&quot;: &quot;view_account&quot;, &quot;finality&quot;: &quot;final&quot;, &quot;account_id&quot;: &quot;test.near&quot;}'

HTTP/1.1 200 OK
access-control-allow-credentials: true
access-control-expose-headers: content-length, accept, connection, user-agent, accept-encoding, content-type, host
content-length: 294
content-type: application/json
date: Tue, 15 Nov 2022 14:04:54 GMT
vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers

{
    &quot;id&quot;: &quot;1&quot;,
    &quot;jsonrpc&quot;: &quot;2.0&quot;,
    &quot;result&quot;: {
        &quot;amount&quot;: &quot;1000000000000000000000000000000000&quot;,
        &quot;block_hash&quot;: &quot;Hn4v5CpfWf141AJi166gdDK3e3khCxgfeDJ9dSXGpAVi&quot;,
        &quot;block_height&quot;: 1611,
        &quot;code_hash&quot;: &quot;11111111111111111111111111111111&quot;,
        &quot;locked&quot;: &quot;50003138579594550524246699058859&quot;,
        &quot;storage_paid_at&quot;: 0,
        &quot;storage_usage&quot;: 182
    }
}
</code></pre>
<p>Note how we use an HTTP <code>post</code> method when we interact with the blockchain RPC.
The full set of RPC endpoints is documented at</p>
<p><a href="https://docs.near.org/api/rpc/introduction">https://docs.near.org/api/rpc/introduction</a></p>
<h2 id="sending-transactions"><a class="header" href="#sending-transactions">Sending Transactions</a></h2>
<p>Transactions are submitted via RPC as well. Submitting a transaction manually
with <code>http</code> is going to be cumbersome though â€” transactions are borsh encoded
to bytes, then signed, then encoded in base64 for JSON.</p>
<p>So we will use the official <a href="https://docs.near.org/tools/near-cli">NEAR CLI</a> utility.</p>
<p>Install it via <code>npm</code>:</p>
<pre><code class="language-console">$ npm install -g near-cli
$ near -h
Usage: near &lt;command&gt; [options]

Commands:
  near create-account &lt;accountId&gt;    create a new developer account
....
</code></pre>
<p>Note that, although you install <code>near-cli</code>, the name of the utility is <code>near</code>.</p>
<p>As a first step, let's redo the <code>view_account</code> call we did with raw <code>httpie</code>
with <code>near-cli</code>:</p>
<pre><code class="language-console">$ NEAR_ENV=local near state test.near
Loaded master account test.near key from ~/.near/validator_key.json with public key = ed25519:71QRP9qKcYRUYXTLNnrmRc1NZSdBaBo9nKZ88DK5USNf
Account test.near
{
  amount: '1000000000000000000000000000000000',
  block_hash: 'ESGN7H1kVLp566CTQ9zkBocooUFWNMhjKwqHg4uCh2Sg',
  block_height: 2110,
  code_hash: '11111111111111111111111111111111',
  locked: '50005124762657986708532525400812',
  storage_paid_at: 0,
  storage_usage: 182,
  formattedAmount: '1,000,000,000'
}
</code></pre>
<p><code>NEAR_ENV=local</code> tells <code>near-cli</code> to use our local network, rather than the
<code>mainnet</code>.</p>
<p>Now, let's create a couple of accounts and send tokes between them:</p>
<pre><code>$ NEAR_ENV=local near create-account alice.test.near --masterAccount test.near
NOTE: In most cases, when connected to network &quot;local&quot;, masterAccount will end in &quot;.node0&quot;
Loaded master account test.near key from /home/matklad/.near/validator_key.json with public key = ed25519:71QRP9qKcYRUYXTLNnrmRc1NZSdBaBo9nKZ88DK5USNf
Saving key to 'undefined/local/alice.test.near.json'
Account alice.test.near for network &quot;local&quot; was created.

$ NEAR_ENV=local near create-account bob.test.near --masterAccount test.near
NOTE: In most cases, when connected to network &quot;local&quot;, masterAccount will end in &quot;.node0&quot;
Loaded master account test.near key from /home/matklad/.near/validator_key.json with public key = ed25519:71QRP9qKcYRUYXTLNnrmRc1NZSdBaBo9nKZ88DK5USNf
Saving key to 'undefined/local/bob.test.near.json'
Account bob.test.near for network &quot;local&quot; was created.

$ NEAR_ENV=local near send alice.test.near bob.test.near 10
Sending 10 NEAR to bob.test.near from alice.test.near
Loaded master account test.near key from /home/matklad/.near/validator_key.json with public key = ed25519:71QRP9qKcYRUYXTLNnrmRc1NZSdBaBo9nKZ88DK5USNf
Transaction Id BBPndo6gR4X8pzoDK7UQfoUXp5J8WDxkf8Sq75tK5FFT
To see the transaction in the transaction explorer, please open this url in your browser
http://localhost:9001/transactions/BBPndo6gR4X8pzoDK7UQfoUXp5J8WDxkf8Sq75tK5FFT
</code></pre>
<p><strong>Note:</strong> You can export the variable <code>NEAR_ENV</code> in your shell if you are planning
to do multiple commands to avoid repetition:</p>
<pre><code class="language-console">export NEAR_ENV=local
</code></pre>
<p>NEAR CLI printouts are not always the most useful or accurate, but this seems to
work.</p>
<p>Note that <code>near</code> automatically creates keypairs and stores them at
<code>.near-credentials</code>:</p>
<pre><code class="language-console">$ ls ~/.near-credentials/local
  alice.test.near.json
  bob.test.near.json
</code></pre>
<p>To verify that this did work, and that <code>near-cli</code> didn't cheat us, let's
query the state of accounts manually:</p>
<pre><code class="language-console">$ http post http://localhost:3030/ method=query jsonrpc=2.0 id=1 \
    params:='{&quot;request_type&quot;: &quot;view_account&quot;, &quot;finality&quot;: &quot;final&quot;, &quot;account_id&quot;: &quot;alice.test.near&quot;}' \
    | jq '.result.amount'
&quot;89999955363487500000000000&quot;

14:30:52|~
Î» http post http://localhost:3030/ method=query jsonrpc=2.0 id=1 \
    params:='{&quot;request_type&quot;: &quot;view_account&quot;, &quot;finality&quot;: &quot;final&quot;, &quot;account_id&quot;: &quot;bob.test.near&quot;}' \
    | jq '.result.amount'
&quot;110000000000000000000000000&quot;
</code></pre>
<p>Indeed, some amount of tokes was transferred from <code>alice</code> to <code>bob</code>, and then
some amount of tokens was deducted to account for transaction fees.</p>
<h2 id="recap"><a class="header" href="#recap">Recap</a></h2>
<p>Great! So we've learned how to run our very own single-node NEAR network using a
binary we've built from source. The steps are:</p>
<ul>
<li>Create configs with <code>cargo run --profile dev-release -p neard -- init</code></li>
<li>Run the node with <code>cargo run --profile dev-release -p neard -- run</code></li>
<li>Poke the node with <code>httpie</code> or</li>
<li>Install <code>near-cli</code> via <code>npm install -g near-cli</code></li>
<li>Submit transactions via <code>NEAR_ENV=local near create-account ...</code></li>
</ul>
<p>In the <a href="./deploy_a_contract.html">next chapter</a>, we'll learn how to deploy a simple
WASM contract.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../practices/workflows/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../practices/workflows/deploy_a_contract.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../practices/workflows/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../practices/workflows/deploy_a_contract.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
