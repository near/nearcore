image: "parity/rust:nightly"

variables:
    CI_SERVER_NAME:  "GitLab CI"
    CARGO_HOME:  "${CI_PROJECT_DIR}/cargo"
    BUILD_TARGET: ubuntu
    BUILD_ARCH: amd64
    CARGO_TARGET: x86_64-unknown-linux-gnu

cache:
    key: "${CI_JOB_NAME}"
    paths:
        - target/
        - cargo/

test:cargo:
    stage: test
    before_script:
    - rustup component add clippy-preview
    - rustup component add rustfmt-preview
    script:
    - rustc --version && cargo --version
    - cargo fmt --all -- --check
    - cargo clippy --all -- -A clippy::unit_arg -A clippy::if_same_then_else -A clippy::collapsible_if -D warnings
    - cargo test --all --verbose -- --test-threads=1
