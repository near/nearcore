image: "parity/rust:substrate"

variables:
  CI_SERVER_NAME:                  "GitLab CI"
  CARGO_HOME:                      "${CI_PROJECT_DIR}/cargo"

  BUILD_TARGET:                    ubuntu
  BUILD_ARCH:                      amd64
  CARGO_TARGET:                    x86_64-unknown-linux-gnu

test:cargo:
    stage: test
    variables:
        RUST_TOOLCHAIN: stable
        TARGET: native    
    script:
        - ./init.sh
        - export PATH="${CI_PROJECT_DIR}/cargo/bin/:$PATH"
        - export RUST_BACKTRACE=1
        - ./build.sh
        - rustc --version && cargo --version
        - cargo test --all --verbose
