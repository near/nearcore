# nearcore

## Rust

- Always prefer `use` declarations over fully qualified paths.
- Don't capitalize string literal messages in logs, errors, `Option::expect`, `panic!`, etc.

## Pull Requests

- Always follow the Pull Requests instructions from `CONTRIBUTING.md`.
- PR titles must follow `<type>: <title>` or `<type>(<project>): <title>` with a lowercase title (e.g. `doc: add Rust conventions to CLAUDE.md`).
- Use bullet-point description for PRs that highlight key changes, motivations, testing, and important context.
- Don't include a separate test plan section (or similar multi-section descriptions).
- Don't include "generated by AI" or similar footers.

## Protocol Schema Check

- Do NOT run the protocol schema check unless explicitly asked. It is expensive.
- When asked to update the schema, first read `tools/protocol-schema-check/README.md`, then follow its instructions exactly. Do NOT guess the command.

## Testing

- To run specific tests, use `cargo test --package {package} --lib --features test_features -- {path::to::test} --exact --show-output`. Use `--feature nightly` if needed.
- When working with test-loop tests, follow the instructions in `test-loop-tests/README.md`.
- Create new testloop tests based on the examples in `test-loop-tests/src/examples/`, as those reflect the latest API and best practices.

## Formatting

- For Rust run `cargo fmt` after making changes. It's cheap.
- For Python run `scripts/formatting --fix`.

## Clippy

- Only run clippy prior to making a commit. It is somewhat expensive.
- Run exact command `RUSTFLAGS="-D warnings" cargo clippy --all-features --all-targets`
- Never run clippy on individual packages

## OpenAPI Spec

- Do NOT update the OpenAPI spec unless explicitly asked.
- When asked, follow the `openapi-spec` recipe in the `Justfile`.
