# Gas Cost Parameters

NEAR charges gas when executing users' WASM code and other transactions. The how
and why is described in other documents, such as [Gas basic
concepts](https://docs.near.org/concepts/basics/transactions/gas), [Gas advanced
concepts](https://docs.near.org/concepts/basics/transactions/gas-advanced), and
[the runtime fee specification](https://nomicon.io/RuntimeSpec/Fees/).

So-called gas cost parameters are part of the protocol definition which can
change between versions. The section on [Parameter Definitions](./parameter_definition.md)
explains how to find the source of truth for such parameter's values in the
nearcore repository and how they can be referenced in code.

The [Gas Profile](./gas_profile.md) section goes into more details on how gas
costs of a transaction are tracked in nearcore.

The [runtime parameter estimator](./estimator.md) is a separate binary within
the nearcore repository. It contains benchmarking-like code used to validate
existing parameters values. When implementing new features, code should be added
there to estimate the safe values of the new parameters. This section is for you
if you are adding new features such as a new pre-compiled method or other host
functions.

Here is a high-level summary of what types of parameters exist.

## Action Costs

Actions are executed in two steps. First, an action is verified and inserted to
an action receipt, which is sent to the receiver of the action. The `send` fee
is paid for this. It is charged either in `fn process_transaction(..)` if the
action is part of a fresh transaction, or inside
[logic.rs](https://github.com/near/nearcore/blob/14b8ae2c7465444c9b672a23b044c00be98f6e34/runtime/near-vm-logic/src/logic.rs)
through `fn pay_action_base(..)` if the action is generated by a function call.
The send fee is meant to cover the cost to validate an action and transmit it
over the network. It can be different for local receipts (sender = receiver).

The second step is action execution. It is charged in `fn apply_action(..)`.
The execution cost has to cover everything required to apply the action to the
blockchain's state.

In conclusion, each action parameter is split into three costs, `send_sir`,
`send_not_sir`, and `execution`. (`sir` = "sender is receiver") Local receipts
charge the first and last parameters, remote receipts charge the second and
third. They should be estimated, defined, and charged separately. But the
reality is that today almost all actions are estimated as a whole and the
parameters are split 50/50 between send and execution cost, without
discrimination on local vs remote receipts  i.e. `send_sir` == `send_not_sir`.


## WASM Costs

Costs that occur while executing a function call on a deployed WASM app (a.k.a.
smart contract) are charged only at the receiver. Thus, they have only one value
to define them, in contrast to action costs.

## Non-gas parameters

Not all runtime parameters are directly related to gas costs. Here is a brief
overview.

- **Gas economics config**: Defines the conversion rate when purchasing gas with
  NEAR tokens and how gas rewards are split.
- **Storage usage config**: Costs in tokens, not gas, for storing data on chain.
- **Account creation config**: Rules for account creation.
- **Smart contract limits**: Rules for WASM execution.

None of the above define any gas costs directly. But there can be interplay
between those parameters and gas costs. For example, the limits on smart
contracts changes the assumptions for how slow a contract compilation could be,
hence it affects the deploy action costs.